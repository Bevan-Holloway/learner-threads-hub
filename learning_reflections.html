<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Reflections - Learner Threads</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f9ff;
            min-height: 100vh;
        }

        .main-app {
            display: block;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .header {
            background: linear-gradient(135deg, #14b8a6, #0891b2);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #bae6fd;
            font-size: 1.1rem;
        }

        .progress-container {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #14b8a6, #0891b2);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.875rem;
            color: #64748b;
            text-align: center;
        }

        .content {
            padding: 2rem;
            min-height: 60vh;
        }

        .section-intro {
            background: linear-gradient(135deg, #f0fdfa, #ccfbf1);
            border-left: 4px solid #14b8a6;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }

        .section-intro h2 {
            color: #0f766e;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .section-intro p {
            color: #0f766e;
            line-height: 1.6;
        }

        .dispositions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .disposition-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .disposition-card:hover {
            border-color: #14b8a6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .disposition-card.selected {
            border-color: #14b8a6;
            background: linear-gradient(135deg, #f0fdfa, #ccfbf1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.2);
        }

        .disposition-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .disposition-name {
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 0.25rem;
        }

        .disposition-desc {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }

        .disposition-prompts {
            background: #f0fdfa;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #99f6e4;
        }

        .disposition-prompts h4 {
            color: #0f766e;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        /* Examples Section Styles */
        .examples-section {
            margin: 1.5rem 0;
        }

        .examples-toggle {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #f0fdfa, #ccfbf1);
            border: 2px solid #14b8a6;
            border-radius: 0.75rem;
            color: #0f766e;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
        }

        .examples-toggle:hover {
            background: linear-gradient(135deg, #ccfbf1, #99f6e4);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(20, 184, 166, 0.2);
        }

        .examples-toggle.expanded {
            border-radius: 0.75rem 0.75rem 0 0;
        }

        .examples-content {
            display: none;
            background: white;
            border: 2px solid #14b8a6;
            border-top: none;
            border-radius: 0 0 0.75rem 0.75rem;
            padding: 1.5rem;
            animation: slideDown 0.3s ease-out;
        }

        .examples-content.visible {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .examples-intro {
            color: #0f766e;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .example-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 3px solid #14b8a6;
        }

        .example-card:last-child {
            margin-bottom: 0;
        }

        .example-header {
            font-weight: 600;
            color: #0891b2;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .example-text {
            color: #374151;
            font-style: italic;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .file-upload-area:hover {
            border-color: #14b8a6;
            background-color: #f0fdfa;
        }

        .file-uploaded {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-name {
            color: #059669;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .file-remove {
            color: #dc2626;
            font-size: 0.75rem;
            cursor: pointer;
            text-decoration: underline;
        }

        .file-remove:hover {
            color: #b91c1c;
        }

        .file-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }

        .upload-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.5rem;
            color: white;
            background: linear-gradient(135deg, #14b8a6, #0891b2);
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        .text-fields-container {
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
            padding: 2rem;
            margin-top: 2rem;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
            font-family: inherit;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #14b8a6;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .input-guidance {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .form-textarea {
            resize: vertical;
            min-height: 150px;
            line-height: 1.6;
        }

        .reflection-preview {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .reflection-title {
            font-size: 2rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .reflection-subtitle {
            font-size: 1.25rem;
            font-weight: 500;
            color: #0f766e;
            text-align: center;
            margin-bottom: 1rem;
        }

        .reflection-meta {
            text-align: center;
            font-size: 0.95rem;
            color: #64748b;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f0fdfa;
            border-radius: 0.5rem;
            border: 1px solid #14b8a6;
        }

        .reflection-meta-item {
            margin-bottom: 0.25rem;
        }

        .reflection-meta-label {
            font-weight: 600;
            color: #0f766e;
            display: inline-block;
            width: 60px;
        }

        .reflection-section {
            margin-bottom: 2rem;
            page-break-inside: avoid;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            border-left: 4px solid #14b8a6;
        }

        .reflection-section h3 {
            color: #0f766e;
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            margin-left: -1.5rem;
            margin-right: -1.5rem;
            margin-top: -1.5rem;
            padding: 1rem 1.5rem;
            background: #14b8a6;
            color: white;
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .opt-in-form-group {
            background-color: #f0fdfa;
            border: 1px solid #99f6e4;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 3rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .opt-in-form-group .form-label {
            margin-bottom: 0.5rem;
            color: #0f766e;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .opt-in-form-group .form-label input[type="checkbox"] {
            flex-shrink: 0;
        }

        .reflection-content {
            color: #374151;
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 1rem;
            text-align: left; 
        }

        .reflection-dispositions {
            background: #f0fdfa;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border: 1px solid #14b8a6;
        }

        .reflection-dispositions strong {
            color: #0f766e;
            font-size: 1rem;
        }

        .navigation {
            background: #f8fafc;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            border-top: 1px solid #e2e8f0;
            border-radius: 0 0 0.75rem 0.75rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #14b8a6, #0891b2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-1px);
        }

        footer {
            margin-top: 2rem;
            text-align: center;
            color: #64748b;
            font-size: 0.875rem;
        }

        footer .copyright {
            font-size: 0.75rem;
            line-height: 1.5;
            display: block;
        }

        .help-section {
            margin: 1rem 0;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            background: #f8fafc;
        }

        .help-toggle {
            width: 100%;
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
            font-size: 0.875rem;
            color: #0891b2;
            font-weight: 500;
        }

        .help-toggle:hover {
            background: #f0fdfa;
        }

        .help-content {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .help-content h4 {
            color: #0f766e;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .help-content p {
            margin-bottom: 1rem;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .content {
                padding: 1.5rem;
            }

            .text-fields-container {
                padding: 1.5rem;
            }

            .dispositions-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .navigation {
                flex-direction: column;
                align-items: center;
            }

            .examples-toggle {
                font-size: 0.875rem;
                padding: 0.875rem;
            }

            .example-card {
                padding: 0.875rem;
            }

            .example-text {
                font-size: 0.85rem;
            }
        }

        @media print {
            #mainApp {
                display: none;
            }
            
            #print-content, #print-content * {
                visibility: visible !important;
            }
            
            #print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 1rem;
                background: white;
                border: none;
                box-shadow: none;
                display: block !important;
            }
            
            #print-content * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            @page {
                margin: 1in;
                size: letter;
            }
        }
    </style>
</head>
<body>
    <div id="mainApp" class="main-app">
        <div class="container">
            <div class="card">
                <div class="header">
                    <h1>My Learning Reflection</h1>
                    <p>Tell the story of your growing learning power</p>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                    </div>
                    <div class="progress-text" id="progressText">Step 1 of 5</div>
                </div>

                <div class="content" id="content">
                    </div>

                <div class="navigation" id="navigation">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()">
                        ‚Üê Previous
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                        Next ‚Üí
                    </button>
                </div>
            </div>

            <footer>
                <p class="copyright">¬© Bevan Holloway | Learner Threads, powered by Smata</p>
            </footer>
        </div>
    </div>

    <script>
        // Application State
        let currentStep = 0;
        let reflection = {
            studentName: '',
            yearLevel: '',
            date: '',
            subject: '',
            whatIDid: '',
            evidenceFile: null,
            evidenceFileName: '',
            evidenceDescription: '',
            learningStrengths: [],
            learningStrengthsReflection: '',
            selectedFuturePrompts: [],
            whereThisTakesMe: '',
            includeTeacherParentComment: false,
            teacherParentComment: ''
        };

        const totalSteps = 5;

        const subjects = [
            'Math',
            'English/Language Arts',
            'Science',
            'Social Studies',
            'Art/Creative',
            'Music',
            'Dance',
            'Drama',
            'Languages',
            'Physical Education',
            'Technology',
            'Other'
        ];

        const yearLevels = [
            'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5',
            'Year 6', 'Year 7', 'Year 8', 'Year 9', 'Year 10',
            'Year 11', 'Year 12', 'Year 13'
        ];

        // What I Did examples data structure - EXPANDED
        const whatIDidExamples = {
            'Years 1-5': [
                { year: 'Year 2', subject: 'Math', text: 'We did counting with blocks today. I had to count to 20 and then group them into tens. We made towers and I counted mine three times to make sure.' },
                { year: 'Year 3', subject: 'Science', text: 'We planted beans in cups and put some by the window and some in the cupboard. I have to water mine every day and measure how tall it gets.' },
                { year: 'Year 4', subject: 'English', text: 'I wrote a story about my dog. It had to have a beginning, middle and end. My story was about when my dog got lost and we found him at the park.' },
                { year: 'Year 5', subject: 'Art', text: 'We learned about colour mixing. I painted a sunset using red, orange and yellow. I had to try mixing the colours to get the right orange.' },
                { year: 'Year 2', subject: 'Music', text: 'We learned about loud and soft sounds. I played the triangle and practiced making it ring loud and then very quietly. We also clapped rhythms.' },
                { year: 'Year 3', subject: 'Drama', text: 'We acted out the story of the Three Little Pigs. I was the wolf and had to practice making my voice scary but not too scary for the little kids watching.' },
                { year: 'Year 4', subject: 'Physical Education', text: 'We practiced throwing and catching balls. I had to throw underarm to my partner and catch without dropping it. We counted how many catches we could do in a row.' },
                { year: 'Year 5', subject: 'Technology', text: 'We built towers with newspaper and tape. Mine kept falling down so I tried making the base wider. I learned that triangles make things stronger.' },
                { year: 'Year 3', subject: 'Languages', text: 'We learned to say hello and goodbye in MƒÅori. I practiced saying "Kia ora" and "Ka kite an≈ç" with the right sounds. We also learned a simple waiata.' },
                { year: 'Year 4', subject: 'Dance', text: 'We made up our own dance to a song about animals. I chose to be a frog and had to make hopping movements that went with the beat.' }
            ],
            'Years 6-9': [
                { year: 'Year 6', subject: 'Social Studies', text: 'We researched different countries for our culture project. I chose Japan and learned about their traditions, food, and festivals. I made a poster with pictures and facts.' },
                { year: 'Year 7', subject: 'Science', text: 'We did an experiment about acids and bases using household items like lemon juice and baking soda. I had to record what happened when we mixed them and write up our observations.' },
                { year: 'Year 8', subject: 'English', text: 'We\'re reading "The Outsiders" and had to write a character analysis about Ponyboy. I had to find quotes from the book that showed what kind of person he was and explain my thinking.' },
                { year: 'Year 9', subject: 'Math', text: 'We\'re learning about linear equations and had to solve word problems about distance and time. Some problems took me ages to figure out what the equation should be.' },
                { year: 'Year 6', subject: 'Technology', text: 'We designed and built a bridge using cardboard and string. I had to test how much weight it could hold and figure out why some designs were stronger than others.' },
                { year: 'Year 7', subject: 'Music', text: 'We composed our own short melody using GarageBand. I experimented with different instruments and learned how to layer tracks to create a fuller sound.' },
                { year: 'Year 8', subject: 'Drama', text: 'We performed scenes from Romeo and Juliet. I played Mercutio and had to understand his character\'s humor and loyalty to Romeo. We worked on voice projection and stage movement.' },
                { year: 'Year 9', subject: 'Physical Education', text: 'We analyzed our fitness levels using different tests like beep test and push-ups. I tracked my progress over 6 weeks and created graphs showing my improvement.' },
                { year: 'Year 7', subject: 'Languages', text: 'We learned to introduce ourselves and describe our families in French. I practiced pronunciation using online tools and recorded myself speaking to check my accent.' },
                { year: 'Year 8', subject: 'Dance', text: 'We learned a traditional Pacific Island dance for our cultural performance. I had to coordinate the arm movements with the footwork while keeping in time with the group.' },
                { year: 'Year 6', subject: 'Art', text: 'We studied Aboriginal dot painting and created our own artwork telling a story. I researched the symbols and their meanings before designing my piece about my family.' }
            ],
            'Years 10-13': [
                { year: 'Year 10', subject: 'History', text: 'I\'m researching the causes of World War I for our assessment. I\'ve been analysing primary sources like letters and newspaper articles to understand different perspectives on why the war started.' },
                { year: 'Year 11', subject: 'Chemistry', text: 'We completed a titration experiment to determine the concentration of an unknown acid solution. I had to be very precise with measurements and repeat the experiment three times to get reliable results.' },
                { year: 'Year 12', subject: 'English', text: 'I\'m writing a creative response to "The Great Gatsby" from the perspective of a minor character. This is challenging because I need to maintain Fitzgerald\'s style while showing events from a completely different viewpoint.' },
                { year: 'Year 13', subject: 'Physics', text: 'I\'m investigating how the angle of a ramp affects the acceleration of a ball rolling down it. This involves collecting data, creating graphs, and using calculus to analyze the motion patterns.' },
                { year: 'Year 10', subject: 'Technology', text: 'I\'m developing a mobile app prototype that helps students track their homework assignments. I\'m learning to code in React Native and designing user interfaces that are intuitive and accessible.' },
                { year: 'Year 11', subject: 'Music', text: 'I\'m composing an original piece for solo piano that explores the theme of changing seasons. I\'m studying how composers like Debussy use harmony and rhythm to create atmospheric effects.' },
                { year: 'Year 12', subject: 'Drama', text: 'I\'m performing Lady Macbeth in our school production. I\'m analyzing her psychological journey through the play and developing physical gestures that show her mental deterioration.' },
                { year: 'Year 13', subject: 'Physical Education', text: 'I\'m conducting a biomechanical analysis of shot put technique, using video analysis software to break down the phases of movement and identify areas for performance improvement.' },
                { year: 'Year 10', subject: 'Languages', text: 'I\'m working on a research project about climate change, presenting my findings entirely in Spanish. This involves learning specialized vocabulary and complex grammatical structures to express scientific concepts.' },
                { year: 'Year 11', subject: 'Dance', text: 'I\'m choreographing a contemporary piece that explores themes of social media and identity. I\'m experimenting with how different movement qualities can represent online versus offline personas.' },
                { year: 'Year 12', subject: 'Art', text: 'I\'m developing a photography series documenting changes in our local environment over time. I\'m learning advanced editing techniques and exploring how visual narratives can raise awareness about environmental issues.' }
            ]
        };

        const dispositions = [
            { 
                name: 'Curiosity', 
                icon: 'üîç', 
                description: 'Asking questions, exploring ideas, wondering about things',
                prompts: [
                    'Having a mind full of questions',
                    'Enjoying researching',
                    'Being amazed by what you \'find\'',
                    'Exploring: things that seem odd, missing, \'how it works\', or other possibilities',
                    'Feeling positive about your learning'
                ]
            },
            { 
                name: 'Persistence', 
                icon: 'üí™', 
                description: 'Sticking with challenges, not giving up when things get tough',
                prompts: [
                    'Putting in the time to practise',
                    'Having a go, even when it\'s hard or difficult',
                    'Reminding yourself of what you are trying to achieve',
                    'Taking a break when you need one, and returning refreshed and with new ideas',
                    'Thinking about the resources that can help you'
                ]
            },
            { 
                name: 'Imagination', 
                icon: 'üí≠', 
                description: 'Trying creative approaches, thinking outside the box',
                prompts: [
                    'Being inventive and experimental',
                    'Wondering and daydreaming',
                    'Using metaphor, humour, and analogies',
                    'Empathising with different perspectives',
                    'Looking for other ways to make use of what you have done or learned'
                ]
            },
            { 
                name: 'Attention', 
                icon: 'üéØ', 
                description: 'Focusing deeply, concentrating on what matters',
                prompts: [
                    'Prioritising',
                    'Using, and developing, strategies that help you focus',
                    'Being observant',
                    'Following what you find interesting in the task',
                    'Tuning out distractions, \'locking in\''
                ]
            },
            { 
                name: 'Thinking', 
                icon: 'üß†', 
                description: 'Making connections, analysing, reasoning through problems',
                prompts: [
                    'Enjoying \'hooking things up\' by looking for connections and associations',
                    'Analysing, reasoning, evaluating, critiquing',
                    'Examining the basis of a conclusion, understanding, or belief',
                    'Testing and sharpening ideas',
                    'Wondering if there might be more to it'
                ]
            },
            { 
                name: 'Collaboration', 
                icon: 'ü§ù', 
                description: 'Working well with others, sharing ideas, helping teammates',
                prompts: [
                    'Taking on varying roles',
                    'Knowing when to listen',
                    'Expressing and defending your own thoughts calmly and clearly',
                    'Being receptive and imitative',
                    'Helping others by building on their contributions'
                ]
            },
            { 
                name: 'Craftsmanship', 
                icon: '‚≠ê', 
                description: 'Caring about quality, wanting to do your best work',
                prompts: [
                    'Developing a \'nose\' for quality and what \'even better\' might look like',
                    'Making honest judgements about how it\'s going',
                    'Making good use of resources (including time and people)',
                    'Being keen to improve by seeking and using feedback',
                    'Tinkering, reviewing and revising, and developing your own style as a result'
                ]
            }
        ];

        // Disposition examples data structure
        const dispositionExamples = {
            'Curiosity': {
                'Years 1-5': [
                    { year: 'Year 3', subject: 'Science', text: 'I kept asking questions about why leaves change colour and discovered there are chemicals inside them that we can\'t usually see' },
                    { year: 'Year 4', subject: 'Maths', text: 'I didn\'t understand the maths at first, but I kept wondering \'what if I try this way?\' and slowly it started making sense' }
                ],
                'Years 6-9': [
                    { year: 'Year 7', subject: 'History', text: 'I started researching what life was really like for ordinary people in medieval times and discovered stories that weren\'t in our textbook' },
                    { year: 'Year 8', subject: 'English', text: 'I was confused by this character\'s choice in the novel, but asking \'why would they do that?\' helped me understand something I\'d missed' }
                ],
                'Years 10-13': [
                    { year: 'Year 11', subject: 'Economics', text: 'I investigated the underlying assumptions in this economic theory and found contradictory evidence that challenged my initial understanding' },
                    { year: 'Year 12', subject: 'Chemistry', text: 'I wasn\'t getting the results I expected in chemistry, so I wondered what variables I might have missed and learnt heaps from investigating' }
                ]
            },
            'Persistence': {
                'Years 1-5': [
                    { year: 'Year 2', subject: 'Maths', text: 'I tried five different ways to solve the word problem and finally found one that made sense to me' },
                    { year: 'Year 5', subject: 'Technology', text: 'My tower kept falling down and I felt frustrated, but I kept trying different shapes until I built one that stayed up' }
                ],
                'Years 6-9': [
                    { year: 'Year 8', subject: 'Maths', text: 'I kept working on this algebra problem using different methods until I finally understood how the formula actually works' },
                    { year: 'Year 9', subject: 'English', text: 'Writing is really hard for me, but I kept rewriting my introduction until it said what I actually meant' }
                ],
                'Years 10-13': [
                    { year: 'Year 11', subject: 'Technology', text: 'I spent hours debugging my code, testing different solutions until I identified the logic error and learnt valuable troubleshooting skills' },
                    { year: 'Year 13', subject: 'Biology', text: 'This topic was really challenging for me, but I worked through multiple drafts until I could explain my thinking clearly' }
                ]
            },
            'Imagination': {
                'Years 1-5': [
                    { year: 'Year 3', subject: 'Science', text: 'I pretended I was a raindrop travelling through the water cycle and it helped me remember all the steps' },
                    { year: 'Year 4', subject: 'English', text: 'I\'m not good at writing stories, but imagining I was actually in the scene helped me think of what to write next' }
                ],
                'Years 6-9': [
                    { year: 'Year 7', subject: 'Maths', text: 'I visualised myself as a detective solving the maths problem step by step, which helped me see the pattern' },
                    { year: 'Year 8', subject: 'History', text: 'I imagined what this event would look like through different people\'s eyes and suddenly the history made more sense' }
                ],
                'Years 10-13': [
                    { year: 'Year 12', subject: 'Physics', text: 'I used metaphors to explain complex scientific concepts in my presentation, making them accessible to my audience' },
                    { year: 'Year 11', subject: 'Engineering', text: 'I struggle with abstract concepts, but visualising different scenarios for this problem helped me find a solution that worked' }
                ]
            },
            'Attention': {
                'Years 1-5': [
                    { year: 'Year 2', subject: 'English', text: 'I focused really carefully on the details in the picture and noticed things that helped me understand the story better' },
                    { year: 'Year 5', subject: 'Music', text: 'It\'s hard for me to concentrate sometimes, but when I listened closely to each instrument, I could hear how they worked together' }
                ],
                'Years 6-9': [
                    { year: 'Year 7', subject: 'Science', text: 'I focused on the key details in the experiment and noticed a pattern that led to an important discovery' },
                    { year: 'Year 9', subject: 'English', text: 'I usually rush through reading, but when I paid attention to the author\'s word choices, I realised how they created the mood' }
                ],
                'Years 10-13': [
                    { year: 'Year 12', subject: 'Statistics', text: 'I concentrated on the subtle changes in the data trends and identified a significant correlation others had missed' },
                    { year: 'Year 13', subject: 'History', text: 'Reading primary sources is challenging for me, but focusing deeply helped me find evidence that changed my understanding' }
                ]
            },
            'Thinking': {
                'Years 1-5': [
                    { year: 'Year 3', subject: 'Maths', text: 'I thought about how this maths problem was like building with blocks and that helped me figure out the answer' },
                    { year: 'Year 4', subject: 'Science', text: 'I was confused at first, but when I compared our science experiment to things I see in my garden, it clicked' }
                ],
                'Years 6-9': [
                    { year: 'Year 8', subject: 'History', text: 'I analysed the different perspectives in this historical conflict and understood why each side made their decisions' },
                    { year: 'Year 9', subject: 'English', text: 'I didn\'t get why the character acted that way, but thinking about their motivations helped me understand the deeper meaning' }
                ],
                'Years 10-13': [
                    { year: 'Year 12', subject: 'Psychology', text: 'I critically examined the methodology of this research study and identified potential biases that affected the conclusions' },
                    { year: 'Year 11', subject: 'Geography', text: 'Connecting ideas is hard for me, but I kept looking for links between different topics until I found patterns that explained heaps' }
                ]
            },
            'Collaboration': {
                'Years 1-5': [
                    { year: 'Year 2', subject: 'Maths', text: 'I listened to my partner\'s idea about sorting the objects and together we found a way that worked even better' },
                    { year: 'Year 5', subject: 'Art', text: 'I\'m quite shy, but when I shared my drawing technique with my group, I learnt a new way to colour from them' }
                ],
                'Years 6-9': [
                    { year: 'Year 7', subject: 'Social Studies', text: 'I built on my teammate\'s research and together we created a presentation that was stronger than either of us could have made alone' },
                    { year: 'Year 9', subject: 'English', text: 'I find it hard to speak up sometimes, but listening to different viewpoints in our debate helped me find my voice' }
                ],
                'Years 10-13': [
                    { year: 'Year 12', subject: 'Business Studies', text: 'I facilitated our group discussion to ensure everyone\'s expertise contributed to our solution, resulting in a more comprehensive analysis' },
                    { year: 'Year 11', subject: 'Design', text: 'Working with others doesn\'t come naturally to me, but giving and receiving feedback improved both our projects significantly' }
                ]
            },
            'Craftsmanship': {
                'Years 1-5': [
                    { year: 'Year 3', subject: 'Art', text: 'I looked at my picture and asked \'how could this be even better?\' then added more details to make it clearer' },
                    { year: 'Year 4', subject: 'English', text: 'My handwriting is messy, but I kept practising until others could read my story easily' }
                ],
                'Years 6-9': [
                    { year: 'Year 8', subject: 'English', text: 'I read my story out loud to check if it flowed well and rewrote the parts that sounded clunky until it was smooth' },
                    { year: 'Year 7', subject: 'Maths', text: 'Maths isn\'t my strongest subject, but I double-checked my calculations and caught an error that would have made everything wrong' }
                ],
                'Years 10-13': [
                    { year: 'Year 12', subject: 'English', text: 'I revised my essay multiple times, seeking feedback and refining my arguments until I produced work I was genuinely proud of' },
                    { year: 'Year 11', subject: 'Chemistry', text: 'Science is really challenging for me, but questioning my method and being careful with details led to results I could trust' }
                ]
            }
        };

        // Helper function to get age bracket from year level
        function getAgeBracket(yearLevel) {
            if (!yearLevel) return 'Years 1-5';
            const yearNum = parseInt(yearLevel.replace('Year ', ''));
            if (yearNum >= 1 && yearNum <= 5) return 'Years 1-5';
            if (yearNum >= 6 && yearNum <= 9) return 'Years 6-9';
            if (yearNum >= 10 && yearNum <= 13) return 'Years 10-13';
            return 'Years 1-5';
        }

        // Function to render examples for "What I Did" step with filtering
        function renderWhatIDidExamples(yearLevel, subject) {
            const ageBracket = getAgeBracket(yearLevel);
            const examples = whatIDidExamples[ageBracket] || [];
            
            // Filter examples based on subject if provided
            let filteredExamples = examples;
            if (subject && subject !== 'Other') {
                // Enhanced subject mapping for better filtering
                const subjectMap = {
                    'Math': ['Math', 'Maths'],
                    'English/Language Arts': ['English'],
                    'Science': ['Science', 'Chemistry', 'Physics', 'Biology'],
                    'Social Studies': ['Social Studies', 'History'],
                    'Art/Creative': ['Art'],
                    'Music': ['Music'],
                    'Dance': ['Dance'],
                    'Drama': ['Drama'],
                    'Languages': ['Languages', 'French', 'Spanish', 'MƒÅori'],
                    'Physical Education': ['Physical Education', 'PE'],
                    'Technology': ['Technology', 'Engineering']
                };
                
                const matchingSubjects = subjectMap[subject] || [subject];
                filteredExamples = examples.filter(example => 
                    matchingSubjects.some(s => example.subject.includes(s))
                );
                
                // If no examples match the specific subject, show all examples from the age bracket
                if (filteredExamples.length === 0) {
                    filteredExamples = examples;
                }
            }
            
            let examplesHtml = '';
            filteredExamples.forEach(example => {
                examplesHtml += `
                    <div class="example-card">
                        <div class="example-header">${example.year} - ${example.subject}</div>
                        <div class="example-text">"${example.text}"</div>
                    </div>
                `;
            });
            
            // Add a note if we're showing filtered results
            if (subject && subject !== 'Other' && filteredExamples.length < examples.length) {
                examplesHtml = `
                    <div style="color: #0f766e; font-size: 0.875rem; margin-bottom: 1rem; padding: 0.75rem; background: #f0fdfa; border-radius: 0.5rem; border: 1px solid #99f6e4;">
                        üìö Showing examples from ${subject} for ${yearLevel} students
                    </div>
                ` + examplesHtml;
            }
            
            return examplesHtml;
        }

        // Function to render examples for selected dispositions with filtering
        function renderExamplesForSelectedDispositions(selectedDispositions, yearLevel, subject) {
            const ageBracket = getAgeBracket(yearLevel);
            
            let examplesHtml = '';
            selectedDispositions.forEach(dispositionName => {
                const examples = dispositionExamples[dispositionName] && dispositionExamples[dispositionName][ageBracket] 
                    ? dispositionExamples[dispositionName][ageBracket] 
                    : [];
                
                // Filter examples based on subject if provided
                let filteredExamples = examples;
                if (subject && subject !== 'Other') {
                    // Enhanced subject mapping for better filtering
                    const subjectMap = {
                        'Math': ['Math', 'Maths'],
                        'English/Language Arts': ['English'],
                        'Science': ['Science', 'Chemistry', 'Physics', 'Biology'],
                        'Social Studies': ['Social Studies', 'History'],
                        'Art/Creative': ['Art'],
                        'Music': ['Music'],
                        'Dance': ['Dance'],
                        'Drama': ['Drama'],
                        'Languages': ['Languages', 'French', 'Spanish', 'MƒÅori'],
                        'Physical Education': ['Physical Education', 'PE'],
                        'Technology': ['Technology', 'Engineering']
                    };
                    
                    const matchingSubjects = subjectMap[subject] || [subject];
                    filteredExamples = examples.filter(example => 
                        matchingSubjects.some(s => example.subject.includes(s))
                    );
                    
                    // If no examples match the specific subject, show all examples for this disposition
                    if (filteredExamples.length === 0) {
                        filteredExamples = examples;
                    }
                }
                
                filteredExamples.forEach(example => {
                    examplesHtml += `
                        <div class="example-card">
                            <div class="example-header">${example.year} - ${example.subject} - ${dispositionName}</div>
                            <div class="example-text">"${example.text}"</div>
                        </div>
                    `;
                });
            });
            
            // Add a note if we're showing filtered results
            if (subject && subject !== 'Other' && selectedDispositions.length > 0) {
                examplesHtml = `
                    <div style="color: #0f766e; font-size: 0.875rem; margin-bottom: 1rem; padding: 0.75rem; background: #f0fdfa; border-radius: 0.5rem; border: 1px solid #99f6e4;">
                        üìö Showing ${subject} examples for ${selectedDispositions.join(', ')} from ${yearLevel} students
                    </div>
                ` + examplesHtml;
            }
            
            return examplesHtml;
        }

        // Function to toggle examples visibility
        function toggleExamples() {
            const toggle = document.getElementById('examplesToggle');
            const content = document.getElementById('examplesContent');
            const isExpanded = content.classList.contains('visible');
            
            if (isExpanded) {
                content.classList.remove('visible');
                toggle.classList.remove('expanded');
                toggle.innerHTML = 'üí° See examples from other students';
            } else {
                content.classList.add('visible');
                toggle.classList.add('expanded');
                toggle.innerHTML = 'üîº Hide examples';
            }
        }

        // Function to toggle "What I Did" examples visibility
        function toggleWhatIDidExamples() {
            const toggle = document.getElementById('whatIDidExamplesToggle');
            const content = document.getElementById('whatIDidExamplesContent');
            const isExpanded = content.classList.contains('visible');
            
            if (isExpanded) {
                content.classList.remove('visible');
                toggle.classList.remove('expanded');
                toggle.innerHTML = 'üí° See examples from other students';
            } else {
                content.classList.add('visible');
                toggle.classList.add('expanded');
                toggle.innerHTML = 'üîº Hide examples';
            }
        }

        const futurePrompts = [
            {
                question: 'What new questions do I have about this topic?',
                helper: 'How has this learning opened up new avenues of inquiry or curiosity for you?',
                details: [
                    'What unanswered questions do you have now?',
                    'What do you want to explore next?',
                    'How has this work sparked new curiosity for you?'
                ]
            },
            {
                question: 'How can I apply this learning in a different context?',
                helper: 'Think about how this skill or knowledge could be useful in another subject, at home, or in a hobby.',
                details: [
                    'Where else could you use this skill or knowledge?',
                    'How could you teach this to someone else?',
                    'What real-world problem could this help you solve?'
                ]
            },
            {
                question: 'What challenges did I overcome, and how can I use that strength again?',
                helper: 'Reflect on moments of persistence and resilience. How can you apply those strategies next time you face difficulty?',
                details: [
                    'What was difficult about this work, and how did you push through?',
                    'What specific strategies did you use to overcome challenges?',
                    'How can you use this strength to tackle future difficult tasks?'
                ]
            },
            {
                question: 'How has this learning changed my thinking or perspective?',
                helper: 'Consider how this experience has broadened your understanding or shifted your viewpoint.',
                details: [
                    'What new ideas do you have after doing this work?',
                    'Has your opinion on anything changed? Why?',
                    'How has this learning influenced your way of looking at the world?'
                ]
            },
            {
                question: 'What is one thing I could do to make my next learning even better?',
                helper: 'Think about craftsmanship and continuous improvement. What small refinement could make a big difference?',
                details: [
                    'What\'s a small adjustment you could make for next time?',
                    'How could you apply feedback to improve?',
                    'What would "even better" look like for your next piece of work?'
                ]
            },
            {
                question: 'How did collaborating with others enhance my learning?',
                helper: 'If you worked with others, reflect on the power of shared ideas and teamwork.',
                details: [
                    'What did you learn from listening to others?',
                    'How did sharing your ideas help you?',
                    'How can you be an even better collaborator next time?'
                ]
            }
        ];

        function toggleHelp(helpId) {
            const helpContent = document.getElementById(helpId);
            const isVisible = helpContent.style.display !== 'none';
            helpContent.style.display = isVisible ? 'none' : 'block';
        }

        function init() {
            renderStep();
            updateProgress();
            updateNavigation();
        }

        function nextStep() {
            if (currentStep < totalSteps - 1) {
                currentStep++;
                renderStep();
                updateProgress();
                updateNavigation();
                window.scrollTo(0, 0);
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                renderStep();
                updateProgress();
                updateNavigation();
                window.scrollTo(0, 0);
            }
        }

        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const percentage = ((currentStep + 1) / totalSteps) * 100;
            
            progressFill.style.width = percentage + '%';
            progressText.textContent = `Step ${currentStep + 1} of ${totalSteps}`;
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (currentStep === totalSteps - 1) {
                document.getElementById('navigation').innerHTML = `
                    <button class="btn btn-secondary" onclick="previousStep()">
                        ‚Üê Back to Edit
                    </button>
                    <button class="btn btn-primary" onclick="saveToPDF()">
                        üíæ Save My Reflection as PDF
                    </button>
                    <button class="btn btn-secondary" onclick="startNewReflection()">
                        üîÑ Start New Reflection
                    </button>
                    <button class="btn btn-secondary" onclick="goToHub()">
                        üè† Back to Hub
                    </button>
                `;
            } else {
                document.getElementById('navigation').innerHTML = `
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()">
                        ‚Üê Previous
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                        Next ‚Üí
                    </button>
                    <button class="btn btn-secondary" onclick="goToHub()" style="margin-left: auto;">
                        üè† Back to Hub
                    </button>
                `;
                
                const restoredPrevBtn = document.getElementById('prevBtn');
                const restoredNextBtn = document.getElementById('nextBtn');
                
                restoredPrevBtn.style.display = currentStep === 0 ? 'none' : 'inline-flex';
                
                if (currentStep === totalSteps - 2) {
                    restoredNextBtn.textContent = 'Complete Reflection';
                    restoredNextBtn.onclick = nextStep;
                } else {
                    restoredNextBtn.textContent = 'Next ‚Üí';
                    restoredNextBtn.onclick = nextStep;
                }
            }
        }

        function updateReflection(field, value) {
            reflection[field] = value;
            if (field === 'includeTeacherParentComment') {
                 renderStep();
                 if (value) {
                    scrollToElement('teacherCommentSection');
                 }
            }
        }

        function toggleStrength(strength) {
            const index = reflection.learningStrengths.indexOf(strength);
            if (index > -1) {
                reflection.learningStrengths.splice(index, 1);
            } else {
                reflection.learningStrengths.push(strength);
            }
            renderStep();
        }

        function toggleFuturePrompt(prompt) {
            const index = reflection.selectedFuturePrompts.indexOf(prompt);
            if (index > -1) {
                reflection.selectedFuturePrompts.splice(index, 1);
            } else {
                reflection.selectedFuturePrompts.push(prompt);
            }
            renderStep();
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 10 * 1024 * 1024) {
                    alert('File size must be less than 10MB');
                    return;
                }
                
                const allowedTypes = ['image/', 'video/', 'audio/'];
                if (!allowedTypes.some(type => file.type.startsWith(type))) {
                    alert('This file type is not supported. Please upload images, videos, or audio files.');
                    return;
                }

                reflection.evidenceFile = file;
                reflection.evidenceFileName = file.name;
                renderStep();
            }
        }

        function removeFile() {
            if (reflection.evidenceFile) {
                URL.revokeObjectURL(reflection.evidenceFile.url);
            }
            reflection.evidenceFile = null;
            reflection.evidenceFileName = '';
            renderStep();
        }

        function saveToPDF() {
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            async function generateAndPrint() {
                let imagesHtml = '';
                
                if (reflection.evidenceFile && reflection.evidenceFile.type.startsWith('image/')) {
                    try {
                        const base64Data = await fileToBase64(reflection.evidenceFile);
                        imagesHtml = `<div style="text-align: center; margin: 1rem 0; page-break-inside: avoid;"><img src="${base64Data}" alt="Learning Evidence" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;"></div>`;
                    } catch (error) {
                        imagesHtml = `<div style="background-color: #dbeafe; border: 1px solid #93c5fd; padding: 0.75rem; border-radius: 6px; margin: 1rem; font-size: 13px; color: #1e40af;">üìé Evidence: ${reflection.evidenceFileName}</div>`;
                    }
                } else if (reflection.evidenceFile) {
                    const fileType = reflection.evidenceFile.type.startsWith('video/') ? 'Video' : 'Audio';
                    imagesHtml = `<div style="background-color: #dbeafe; border: 1px solid #93c5fd; padding: 0.75rem; border-radius: 6px; margin: 1rem; font-size: 13px; color: #1e40af;">üìé Evidence: ${fileType}: ${reflection.evidenceFileName}</div>`;
                }

                const studentWhatIDidSection = `
                    <div style="margin-bottom: 1.5rem; page-break-inside: avoid;">
                        <div style="background: #14b8a6; color: white; padding: 0.75rem 1rem; border-radius: 6px 6px 0 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                            <span style="font-size: 18px;">üìù</span>
                            What I Did
                        </div>
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 6px 6px; padding: 1rem; min-height: 40px; text-align: left;">
                            <div style="color: #374151; line-height: 1.6; white-space: pre-wrap;">${reflection.whatIDid}</div>
                            ${imagesHtml}
                        </div>
                    </div>
                `;

                const studentHowIGrewSection = `
                    <div style="margin-bottom: 1.5rem; page-break-inside: avoid;">
                        <div style="background: #14b8a6; color: white; padding: 0.75rem 1rem; border-radius: 6px 6px 0 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                            <span style="font-size: 18px;">‚≠ê</span>
                            How I Grew as a Learner
                        </div>
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 6px 6px; padding: 1rem; min-height: 40px; text-align: left;">
                            ${reflection.learningStrengths.length > 0 ? `
                            <div style="background: linear-gradient(135deg, #f0fdfa, #ccfbf1); border: 1px solid #14b8a6; padding: 0.75rem; border-radius: 4px; margin-bottom: 0.75rem;">
                                <div style="font-weight: 600; color: #0f766e; margin-bottom: 0.25rem;">My learning was powered by:</div>
                                <div style="color: #134e4a; font-style: italic;">${reflection.learningStrengths.join(' ‚Ä¢ ')}</div>
                            </div>
                            ` : ''}
                            ${reflection.learningStrengthsReflection ? `
                            <div style="color: #374151; line-height: 1.6; white-space: pre-wrap;">${reflection.learningStrengthsReflection}</div>
                            ` : ''}
                        </div>
                    </div>
                `;

                const studentWhereThisTakesMeSection = `
                    <div style="margin-bottom: 1.5rem; page-break-inside: avoid;">
                        <div style="background: #14b8a6; color: white; padding: 0.75rem 1rem; border-radius: 6px 6px 0 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                            <span style="font-size: 18px;">üöÄ</span>
                            Where This Could Take Me
                        </div>
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 6px 6px; padding: 1rem; min-height: 40px; text-align: left;">
                            <div style="color: #374151; line-height: 1.6; white-space: pre-wrap;">${reflection.whereThisTakesMe}</div>
                        </div>
                    </div>
                `;

                let teacherParentCommentSection = '';
                if (reflection.includeTeacherParentComment) {
                    let teacherCommentContentHTML;
                    const blankSpaceForHandwrittenNotes = `
                        <div style="height: 180px; background-color: #ffffff; border: 1px dashed #cbd5e1; padding: 1rem; border-radius: 0.5rem; text-align: left; display: flex; align-items: center; justify-content: center;">
                            </div>
                    `;

                    if (reflection.teacherParentComment) {
                        teacherCommentContentHTML = `<div style="color: #374151; line-height: 1.6; white-space: pre-wrap; text-align: left !important; padding: 1rem; background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 0.5rem;">${reflection.teacherParentComment}</div>`;
                    } else {
                        teacherCommentContentHTML = blankSpaceForHandwrittenNotes;
                    }

                    teacherParentCommentSection = `
                        <div style="margin-top: 2rem; margin-bottom: 1.5rem; page-break-inside: avoid;">
                            <div style="background: linear-gradient(135deg, #0891b2, #14b8a6); color: white; padding: 0.75rem 1rem; border-radius: 6px 6px 0 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                <span style="font-size: 18px;">‚úçÔ∏è</span>
                                A Note from Your Teacher/Parent
                            </div>
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 6px 6px; padding: 1rem; min-height: 80px; text-align: left;">
                                ${teacherCommentContentHTML}
                            </div>
                            <p style="margin-top: 0.5rem; font-style: italic; font-size: 0.875rem; color: #6b7280; text-align: left;">
                                This learning story is not stored by the app: make sure you save it to your device.
                            </p>
                        </div>
                    `;
                }

                const printContent = `
                    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.5; color: #0f172a; max-width: 8.5in; margin: 0 auto; padding: 0.5rem; background: white;">
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <div style="font-size: 28px; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Learning Reflection</div>
                            <div style="font-size: 18px; font-weight: 500; color: #14b8a6; margin-bottom: 1rem;">${reflection.studentName}</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #f0fdfa, #ccfbf1); border: 1px solid #14b8a6; border-radius: 6px; padding: 1rem; margin-bottom: 1rem; text-align: center;">
                            <div style="margin-bottom: 0.25rem; font-size: 14px;">
                                <span class="reflection-meta-label">Date:</span> ${formatDate(reflection.date)}
                            </div>
                            <div style="margin-bottom: 0.25rem; font-size: 14px;">
                                <span class="reflection-meta-label">Year Level:</span> ${reflection.yearLevel}
                            </div>
                            <div style="font-size: 14px;">
                                <span class="reflection-meta-label">Subject:</span> ${reflection.subject}
                            </div>
                        </div>
                        
                        ${studentWhatIDidSection}
                        ${studentHowIGrewSection}
                        ${studentWhereThisTakesMeSection}
                        ${teacherParentCommentSection}
                        
                        <div style="margin-top: 2rem; padding-top: 0.75rem; border-top: 1px solid #e2e8f0; text-align: center; font-size: 11px; color: #64748b;">
                            <div style="font-weight: 600; color: #14b8a6; margin-bottom: 0.125rem;">Learner Threads</div>
                            <div>¬© Bevan Holloway | Student Learning Reflection | Learner Threads is powered by Smata</div>
                        </div>
                    </div>
                `;

                const printContainer = document.createElement('div');
                printContainer.innerHTML = printContent;
                printContainer.style.display = 'none';
                printContainer.id = 'print-content';
                
                const existing = document.getElementById('print-content');
                if (existing) {
                    existing.remove();
                }
                
                document.body.appendChild(printContainer);
                document.getElementById('mainApp').style.display = 'none';

                setTimeout(() => {
                    window.print();
                    
                    setTimeout(() => {
                        printContainer.remove();
                        document.getElementById('mainApp').style.display = 'block';
                    }, 1000);
                }, 100);
            }

            generateAndPrint();
        }

        function startNewReflection() {
            reflection = {
                studentName: '',
                yearLevel: '',
                date: '',
                subject: '',
                whatIDid: '',
                evidenceFile: null,
                evidenceFileName: '',
                evidenceDescription: '',
                learningStrengths: [],
                learningStrengthsReflection: '',
                selectedFuturePrompts: [],
                whereThisTakesMe: '',
                includeTeacherParentComment: false,
                teacherParentComment: ''
            };
            currentStep = 0;
            init();
        }

        function goToHub() {
            window.location.href = 'index.html';
        }

        function scrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                setTimeout(() => {
                    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100); 
            }
        }

        function renderStep() {
            const content = document.getElementById('content');
            
            switch (currentStep) {
                case 0:
                    content.innerHTML = renderSetupStep();
                    break;
                case 1:
                    content.innerHTML = renderWhatIDidStep();
                    break;
                case 2:
                    content.innerHTML = renderLearningStrengthsStep();
                    break;
                case 3:
                    content.innerHTML = renderWhereThisTakesMeStep();
                    if (reflection.includeTeacherParentComment) {
                        scrollToElement('teacherCommentSection'); 
                    }
                    break;
                case 4:
                    content.innerHTML = renderReviewStep();
                    break;
            }
        }

        function renderSetupStep() {
            return `
                <div class="section-intro">
                    <h2>Let's Start Your Learning Reflection</h2>
                    <p>Type your name, enter today's date, and pick the subject you have been growing your learning powers in. This helps create a personalised reflection of your learning journey.</p>
                </div>

                <div class="text-fields-container">
                    <div class="form-group">
                        <label class="form-label">Your Name</label>
                        <input type="text" class="form-input" value="${reflection.studentName}" 
                               onchange="updateReflection('studentName', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Year Level</label>
                        <div class="input-guidance">This helps us show you the most relevant examples</div>
                        <select class="form-select" value="${reflection.yearLevel}"
                                onchange="updateReflection('yearLevel', this.value)">
                            <option value="">Select year level...</option>
                            ${yearLevels.map(year => 
                                `<option value="${year}" ${reflection.yearLevel === year ? 'selected' : ''}>${year}</option>`
                            ).join('')}
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" value="${reflection.date}"
                               onchange="updateReflection('date', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Subject Area</label>
                        <div class="input-guidance">What subject were you working on?</div>
                        <select class="form-select" value="${reflection.subject}"
                                onchange="updateReflection('subject', this.value)">
                            <option value="">Select subject...</option>
                            ${subjects.map(subject => 
                                `<option value="${subject}" ${reflection.subject === subject ? 'selected' : ''}>${subject}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
            `;
        }

        function renderWhatIDidStep() {
            return `
                <div class="section-intro">
                    <h2>What I Did</h2>
                    <p>Describe what you worked on. Be specific about what you actually did, for how long, and why you were doing it.</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Add Evidence (Optional)</label>
                    <div class="file-upload-area">
                        ${reflection.evidenceFile ? `
                            <div class="file-uploaded">
                                <div class="file-info">
                                    <span class="file-name">${reflection.evidenceFileName}</span>
                                    <span class="file-remove" onclick="removeFile()">Remove</span>
                                </div>
                                ${reflection.evidenceFile.type.startsWith('image/') ? 
                                    `<img src="${URL.createObjectURL(reflection.evidenceFile)}" alt="Evidence" class="file-preview">` : 
                                reflection.evidenceFile.type.startsWith('video/') ? 
                                    `<video src="${URL.createObjectURL(reflection.evidenceFile)}" controls class="file-preview"></video>` :
                                reflection.evidenceFile.type.startsWith('audio/') ? 
                                    `<audio src="${URL.createObjectURL(reflection.evidenceFile)}" controls style="width: 200px;"></audio>` : ''}
                            </div>
                        ` : `
                            <div>
                                <input type="file" accept="image/*,video/*,audio/*"
                                        onchange="handleFileUpload(event)" style="display: none;" id="evidence-upload">
                                <label for="evidence-upload" class="upload-button">üìé Choose File</label>
                                <p style="margin-top: 0.5rem; color: #64748b;">
                                    Upload a photo of your work (max 10MB)
                                </p>
                            </div>
                        `}
                    </div>
                </div>

                <div class="text-fields-container">
                    <div class="form-group">
                        <label class="form-label">Describe what you worked on</label>
                        <div class="input-guidance">
                            <strong>Describe what you worked on:</strong><br>
                            ‚Ä¢ What was the task and why were you doing it?<br>
                            ‚Ä¢ Use the examples below if you need ideas.
                        </div>

                        <div class="examples-section">
                            <button class="examples-toggle" id="whatIDidExamplesToggle" onclick="toggleWhatIDidExamples()">
                                üí° See examples from other students
                            </button>
                            <div class="examples-content" id="whatIDidExamplesContent">
                                <div class="examples-intro">Examples to inspire your reflection:</div>
                                ${renderWhatIDidExamples(reflection.yearLevel, reflection.subject)}
                            </div>
                        </div>

                        <textarea class="form-textarea" rows="6" 
                                        data-field="whatIDid"
                                        onchange="updateReflection('whatIDid', this.value)">${reflection.whatIDid}</textarea>
                    </div>
                </div>
            `;
        }

        function renderLearningStrengthsStep() {
            return `
                <div class="section-intro">
                    <h2>How I Grew as a Learner</h2>
                    <p>What was your learning powered by? Select the ones that describe how you learned during this work, then use the prompts to write about how you used them.</p>
                </div>

                <div class="dispositions-grid">
                    ${dispositions.map(disposition => `
                        <div class="disposition-card ${reflection.learningStrengths.includes(disposition.name) ? 'selected' : ''}"
                               onclick="toggleStrength('${disposition.name}')">
                            <div class="disposition-icon">${disposition.icon}</div>
                            <div class="disposition-name">${disposition.name}</div>
                            <div class="disposition-desc">${disposition.description}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="text-fields-container">
                    ${reflection.learningStrengths.length > 0 ? `
                        <div class="disposition-prompts">
                            <h4 style="color: #0f766e; margin-bottom: 1rem;">Ideas for your reflection:</h4>
                            ${dispositions.filter(d => reflection.learningStrengths.includes(d.name)).map(disposition => `
                                    <div style="margin-bottom: 1rem; padding: 1rem; background: #f0fdfa; border-radius: 0.5rem; border-left: 3px solid #14b8a6;">
                                        <div style="color: #0f766e; font-weight: 600; margin-bottom: 0.5rem;">When ${disposition.name.toLowerCase()} powers your learning, you might find yourself:</div>
                                        ${disposition.prompts.map(prompt => `
                                            <div style="color: #134e4a; font-size: 0.875rem; margin: 0.25rem 0; padding-left: 1rem;">‚Ä¢ ${prompt}</div>
                                        `).join('')}
                                    </div>
                                `).join('')}
                        </div>

                        <div class="examples-section">
                            <button class="examples-toggle" id="examplesToggle" onclick="toggleExamples()">
                                üí° See examples from other students
                            </button>
                            <div class="examples-content" id="examplesContent">
                                <div class="examples-intro">Examples to inspire your reflection:</div>
                                ${renderExamplesForSelectedDispositions(reflection.learningStrengths, reflection.yearLevel, reflection.subject)}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="form-group">
                        <label class="form-label">How I Used These to Power My Learning</label>
                        <div class="input-guidance">
                            <strong>Write about your learning powers:</strong><br>
                            ‚Ä¢ Start with "X helped power my learning because..."<br>
                            ‚Ä¢ Use the examples above for inspiration.
                        </div>

                        <textarea class="form-textarea" rows="6" 
                                        onchange="updateReflection('learningStrengthsReflection', this.value)">${reflection.learningStrengthsReflection || ''}</textarea>
                    </div>
                </div>
            `;
        }

        function renderWhereThisTakesMeStep() {
            return `
                <div class="section-intro">
                    <h2>Where This Could Take Me</h2>
                    <p>Think about the future. Pick a couple of these questions to guide your reflection:</p>
                </div>

                <div class="dispositions-grid">
                    ${futurePrompts.map(prompt => `
                        <div class="disposition-card ${reflection.selectedFuturePrompts.includes(prompt.question) ? 'selected' : ''}"
                               onclick="toggleFuturePrompt('${prompt.question}')">
                            <div class="disposition-icon">ü§î</div>
                            <div class="disposition-name">${prompt.question}</div>
                            <div class="disposition-desc">${prompt.helper}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="text-fields-container">
                    ${reflection.selectedFuturePrompts.length > 0 ? `
                        <div class="disposition-prompts">
                            <h4 style="color: #0f766e; margin-bottom: 1rem;">Ideas for your reflection:</h4>
                            ${reflection.selectedFuturePrompts.map(selectedQuestion => {
                                const prompt = futurePrompts.find(p => p.question === selectedQuestion);
                                return prompt ? `
                                        <div style="margin-bottom: 1rem; padding: 1rem; background: #f0fdfa; border-radius: 0.5rem; border-left: 3px solid #14b8a6;">
                                            <div style="color: #0f766e; font-weight: 600; margin-bottom: 0.5rem;">${selectedQuestion}</div>
                                            ${prompt.details.map(detail => `
                                                <div style="color: #134e4a; font-size: 0.875rem; margin: 0.25rem 0; padding-left: 1rem;">‚Ä¢ ${detail}</div>
                                            `).join('')}
                                        </div>
                                    ` : '';
                            }).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="form-group">
                        <label class="form-label">Future Possibilities</label>
                        <div class="input-guidance">
                            <strong>What doors has this opened?</strong><br>
                            ‚Ä¢ Use the questions üëÜ to help you think about what you might do next<br>
                            ‚Ä¢ Examples below show different approaches.
                        </div>

                        <div class="help-section">
                            <button class="help-toggle" onclick="toggleHelp('futureHelp')">
                                ‚ùì Need help? See examples
                            </button>
                            <div id="futureHelp" class="help-content" style="display: none;">
                                <h4>Example: Sam (Science)</h4>
                                <p><em>"I want to try this experiment at home with different types of seeds. I'm curious about whether music or talking to plants actually helps them grow like my nan says. This experiment taught me that being really careful with measurements is important in science."</em></p>
                                
                                <h4>Example: Alex (English)</h4>
                                <p><em>"I realised I really enjoy creating characters and exploring their emotions. I might try writing a longer story or even start a creative writing blog. This project also taught me that revision isn't just fixing mistakes - it's about making your ideas clearer and more powerful. I want to use this same careful approach in my history essays."</em></p>
                                
                                <h4>Example: Maya (Maths)</h4>
                                <p><em>"Now I notice fractions everywhere - when mum cuts an apple or when we share biscuits. I want to try using fractions when I help with baking. I learned that maths is easier when I can touch things and make it into a story."</em></p>

                                <h4>Example: Jordan (Maths)</h4>
                                <p><em>"I want to try more word problems. Maybe easier ones first. I think I'm getting better at not giving up. I want to ask for help more because that worked. Maybe I could help someone else too."</em></p>
                            </div>
                        </div>

                        <textarea class="form-textarea" rows="6" 
                                        onchange="updateReflection('whereThisTakesMe', this.value)">${reflection.whereThisTakesMe}</textarea>
                    </div>

                    <div class="opt-in-form-group">
                        <label class="form-label">
                            <input type="checkbox" style="width: 20px; height: 20px; border: 2px solid #14b8a6; border-radius: 4px; flex-shrink: 0;"
                                        ${reflection.includeTeacherParentComment ? 'checked' : ''}
                                        onchange="updateReflection('includeTeacherParentComment', this.checked); if(this.checked) scrollToElement('teacherCommentSection');">
                            <span><strong>Would you like to include Teacher/Parent Notes on your reflection?</strong></span>
                        </label>
                        <p class="input-guidance">
                            <strong>This is a great opportunity to chat with a teacher or parent about your learning.</strong> After your discussion, they can type their notes directly into the space provided on the final review screen. Or, leave it blank and space will be proved for them to handwrite their notes later.
                        </p>
                    </div>

                    ${reflection.includeTeacherParentComment ? `
                        <div id="teacherCommentStudentContext" style="margin-top: 3rem;">
                            <h4 style="color: #0f766e; margin-bottom: 1rem; font-size: 1.1rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem;">Student's Reflection for Discussion:</h4>
                            
                            <div class="reflection-section" style="border-left: 4px solid #14b8a6; padding: 1rem 1.5rem; margin-bottom: 1.5rem;">
                                <h3 style="background: #14b8a6; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem 0.5rem 0 0; font-size: 1rem; margin: -1rem -1.5rem 1rem -1.5rem;">What I Did</h3>
                                <div class="reflection-content">${reflection.whatIDid || '<i>(Student has not yet completed this section)</i>'}</div>
                                ${reflection.evidenceFile ? `
                                <div style="margin-top: 1rem; text-align: center;">
                                    ${reflection.evidenceFile.type.startsWith('image/') ? `
                                        <img src="${URL.createObjectURL(reflection.evidenceFile)}" alt="Learning Evidence" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    ` : `
                                        <div style="background: #e0f2f7; padding: 0.5rem; border-radius: 0.25rem; border: 1px solid #a7d9ee; font-size: 0.85rem; color: #086d8a;">üìé Evidence: ${reflection.evidenceFileName}</div>
                                    `}
                                </div>
                                ` : ''}
                            </div>

                            <div class="reflection-section" style="border-left: 4px solid #14b8a6; padding: 1rem 1.5rem; margin-bottom: 1.5rem;">
                                <h3 style="background: #14b8a6; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem 0.5rem 0 0; font-size: 1rem; margin: -1rem -1.5rem 1rem -1.5rem;">How I Grew as a Learner</h3>
                                <div class="reflection-content">${reflection.learningStrengthsReflection || '<i>(Student has not yet completed this section)</i>'}</div>
                                ${reflection.learningStrengths.length > 0 ? `
                                <div style="background: #e0f2f7; padding: 0.75rem; border-radius: 0.5rem; margin-top: 1rem; border: 1px solid #a7d9ee;">
                                    <strong style="color: #0f766e; font-size: 0.95rem;">Powered by:</strong> <span style="color: #134e4a;">${reflection.learningStrengths.join(' ‚Ä¢ ')}</span>
                                </div>
                                ` : ''}
                            </div>

                            <div class="reflection-section" style="border-left: 4px solid #14b8a6; padding: 1rem 1.5rem; margin-bottom: 1.5rem;">
                                <h3 style="background: #14b8a6; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem 0.5rem 0 0; font-size: 1rem; margin: -1rem -1.5rem 1rem -1.5rem;">Where This Could Take Me</h3>
                                <div class="reflection-content">${reflection.whereThisTakesMe || '<i>(Student has not yet completed this section)</i>'}</div>
                            </div>
                        </div>
                        <div class="form-group" id="teacherCommentSection">
                            <label class="form-label">A Note from Your Teacher/Parent</label>
                            <div class="input-guidance">
                                <strong>In this discussion, look for the unique 'threads' this learner has left:</strong><br>
                                ‚Ä¢ A first question, a moment of bravery, a flicker of agency, the use of a disposition, a breakthrough<br>
                                ‚Ä¢ Think about the growth that is evident in the story<br>
                                ‚Ä¢ See the guidance below for questions to ask and ways to write your observations.
                            </div>

                            <div class="help-section">
                                <button class="help-toggle" onclick="toggleHelp('teacherCommentHelp')">
                                    ‚ùì Need help? See guidance for teachers/parents
                                </button>
                                <div id="teacherCommentHelp" class="help-content" style="display: none;">
                                    <h4>Questions You Could Ask During Your Discussion:</h4>
                                    <p><strong>‚Ä¢ What surprised you about this learning?<br>
                                    ‚Ä¢ Which part are you most proud of and why?<br>
                                    ‚Ä¢ How did you handle the tricky bits?<br>
                                    ‚Ä¢ What has this showed you is possible?<br>
                                    ‚Ä¢ What would you tell your family or another teacher about this?<br>
                                    ‚Ä¢ What questions do you have now?</strong></p>

                                    <h4>Tips for Writing Your Note:</h4>
                                    <p><strong>‚Ä¢ Use their name and speak directly to them<br>
                                    ‚Ä¢ Notice and name specific dispositions they used (curiosity, persistence, etc.)<br>
                                    ‚Ä¢ Celebrate breakthroughs, insights, small steps and first glimmers: they're all evidence of growth<br>
                                    ‚Ä¢ Focus on what they DID do, not what they didn't<br>
                                    ‚Ä¢ Connect to their future learning or interests<br>
                                    ‚Ä¢ Write as if you're having a conversation with them</strong></p>
                                    
                                    <h4>Example: Celebrating First Glimmers (Year 4):</h4>
                                    <p><em>"Jordan, I noticed something really important in your reflection - you wrote that you 'didn't give up even when it was hard.' That's persistence, and it's one of the most powerful learning strengths anyone can have. When you got stuck on that problem, instead of saying 'I can't do this,' you tried a different way. That's exactly what mathematicians do! You might not have got the final answer, but you showed me you're becoming a real problem-solver. I'm excited to see where this persistence takes you next."</em></p>
                                    
                                    <h4>Example: Noticing Small Steps (Secondary):</h4>
                                    <p><em>"Casey, what stood out to me was when you said you 'asked one question in class for the first time.' I know speaking up doesn't come easily for you, so that moment of curiosity breaking through was powerful to see. That question you asked actually helped three other students who were wondering the same thing. Your willingness to be vulnerable in your learning is inspiring - it shows real courage. I wonder what other questions are bubbling up for you?"</em></p>

                                    <h4>Example Teacher Comment (Primary):</h4>
                                    <p><em>"Maya, I loved watching you discover that fractions are everywhere! You showed real imagination when you turned the maths into a pizza shop game - that creative thinking helped you understand something quite abstract. Your collaboration with Sarah was beautiful to see - the way you both used the playdough to help each other really shows how learning together makes everyone stronger. I'm excited to see how you use fractions when you help with baking!"</em></p>
                                    
                                    <h4>Example Parent Comment (Secondary):</h4>
                                    <p><em>"Alex, what strikes me most about your reflection is how you've learned that revision isn't just 'fixing mistakes' - you've discovered it's about making your ideas shine. That's a massive realisation that will serve you in so many areas. Your persistence when you got stuck in the middle of your story really impressed me. The fact that you want to apply this careful approach to your history essays shows you're thinking like a real learner - seeing connections across subjects. I'm curious to read that creative writing blog you mentioned!"</em></p>
                                    
                                </div>
                            </div>

                            <textarea class="form-textarea" rows="4" 
                                            placeholder="Type comments here..."
                                            style="text-align: left; padding: 1rem;" 
                                            onchange="updateReflection('teacherParentComment', this.value)">${reflection.teacherParentComment || ''}</textarea>
                            <p style="margin-top: 0.5rem; font-style: italic; font-size: 0.875rem; color: #6b7280;">
                                This learning story is not stored by the app: make sure you save it to your device.
                            </p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderReviewStep() {
            return `
                <div class="section-intro">
                    <h2>Review Your Learning Reflection</h2>
                    <p>Here's your complete learning reflection. Review it carefully, and if you need to make any changes, use the "Back to Edit" button. When you're happy with it, save it as a PDF.</p>
                </div>

                <div class="reflection-preview">
                    <div class="reflection-title">Learning Reflection</div>
                    <div class="reflection-subtitle">${reflection.studentName}</div>
                    <div class="reflection-meta">
                        <div class="reflection-meta-item">
                            <span class="reflection-meta-label">Date:</span> ${formatDate(reflection.date)}
                        </div>
                        <div class="reflection-meta-item">
                            <span class="reflection-meta-label">Year:</span> ${reflection.yearLevel}
                        </div>
                        <div class="reflection-meta-item">
                            <span class="reflection-meta-label">Subject:</span> ${reflection.subject}
                        </div>
                    </div>

                    <div class="reflection-section">
                        <h3>What I Did</h3>
                        <div class="reflection-content">${reflection.whatIDid}</div>
                        ${reflection.evidenceFile ? `
                        <div style="margin-top: 1rem;">
                            ${reflection.evidenceFile.type.startsWith('image/') ? `
                                <div style="text-align: center; margin: 1rem 0;">
                                    <img src="${URL.createObjectURL(reflection.evidenceFile)}" alt="Learning Evidence" 
                                                style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                                </div>
                            ` : `
                                <div style="background: #f0fdfa; padding: 0.75rem; border-radius: 0.5rem; margin: 0.5rem 0; border: 1px solid #14b8a6;">
                                    <span style="color: #0f766e; font-weight: 500;">üìé Evidence:</span> 
                                    <span style="color: #64748b;">${reflection.evidenceFileName}</span>
                                </div>
                            `}
                        </div>
                        ` : ''}
                    </div>

                    <div class="reflection-section">
                        <h3>How I Grew as a Learner</h3>
                        <div class="reflection-content">${reflection.learningStrengthsReflection}</div>
                        ${reflection.learningStrengths.length > 0 ? `
                        <div class="reflection-dispositions">
                            <strong>My learning was powered by:</strong> ${reflection.learningStrengths.join(', ')}
                        </div>
                        ` : ''}
                    </div>

                    <div class="reflection-section">
                        <h3>Where This Could Take Me</h3>
                        <div class="reflection-content">${reflection.whereThisTakesMe}</div>
                    </div>

                    ${reflection.includeTeacherParentComment ? `
                        <div class="reflection-section" style="border-left: 4px solid #0891b2;">
                            <h3>A Note from Your Teacher/Parent</h3>
                            <div style="color: #374151; line-height: 1.6; white-space: pre-wrap; text-align: left; padding: 0;">
                                ${reflection.teacherParentComment ? reflection.teacherParentComment : `<p style="color: #6b7280; font-style: italic; margin-bottom: 0; text-align: left;">Space for Teacher/Parent Notes (for handwritten additions)</p>`}
                            </div>
                            <p style="margin-top: 0.5rem; font-style: italic; font-size: 0.875rem; color: #6b7280;">
                                This learning story is not stored by the app: make sure you save it to your device.
                            </p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            return date.toLocaleDateString('en-NZ', options);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>